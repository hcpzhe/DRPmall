(function() {
    var a = document.images.length;
    for (var c = 0; c < a; c++) {
        var b = document.images[c], d = b.getAttribute("data-src");
        if (d) {
            b.src = d;
            b.removeAttribute("data-src");
        }
    }
})();
function hideLayer() {
    $(".loginLabel").addClass("none");
}
function userLogin() {
    $.showLoginBox(function() {
        hideLayer();
        location.reload();
    });
}
var _tag = [];
var __ = 0;
function TIMER(a) {
    window._time = window._time || $('#JS_sever_current_time').val();
    this.id = a;
    this.obj = $("#" + a);
    this.html = this.obj.attr("data-format");
    this.leftTime = this.obj.attr("data-lefttime") - window._time;
    this.btn = this.obj.parent().find(".sbtn");
}
TIMER.prototype = {fill: function() {
        var f = this;
        var g = (f.leftTime - __) || 0;

        if (g < 0) {
            g = 0;
            var i = f.obj.attr("data-index");
            if (i) {
                var k = $("#JS_count_down_show_" + i);
                var e = $("#JS_count_down_hide_" + i);
                if (e.length) {
                    k.addClass("none");
                    e.removeClass("none");
                }
            }
            if (f.btn.hasClass("JS_sec_tmp_2")) {
                f.btn.removeClass("JS_sec_tmp_2").addClass("JS_sec_tmp_3");
            }
        }
        var l = g % 60;
        if (l < 10) {
            l = "0" + l;
        }
        var a = parseInt(g % 3600 / 60);
        if (a < 10) {
            a = "0" + a;
        }
        var c = parseInt(g % (3600 * 24) / 3600);
        if (c < 10) {
            c = "0" + c;
        }
        var j = parseInt(g / (3600 * 24));
        if (f.html.indexOf("$D") < 0) {
            c = (j * 24) - 0 + (c - 0);
        }
        var b = f.html.replace("$D", j).replace("$H", c).replace("$M", a).replace("$S", l);
        f.obj.html(b);
    }};
var countDown = function() {
    for (var a = 0; a < _tag.length; a++) {
        _tag[a].fill();
    }
    __++;
    setTimeout(function() {
        countDown();
    }, 1000);
};
var tagInit = function(d) {
    d = d || "";
    _tag = [];
    var a = $(".JS_count_down_tag");
    for (var b = 0, c = a.length; b < c; b++) {
        a.eq(b).attr("id", "count_down_OoO_" + d + b);
        _tag[b] = new TIMER("count_down_OoO_" + d + b);
    }
};
function _COMMON_UNIX_TIME(a) {
    if (a && a.html_content) {
        window._time = a.html_content;
        tagInit();
    }
}
$(document).ready(function() {
    tagInit();
    countDown();
    function g(i, m, k) {
        $.closeLightBox("JS_lightBox_seckill_box");
        var j = '<div class="lightBox seckill ' + (k || "") + '" id="JS_lightBox_seckill_box"><div class="in"><div class="clearfix title"><div class="Left"><i style="display:inline-block;"></i><span>' + (m || "提示") + '</span></div><a href="javascript:;" class="Right" onclick="$.closeLightBox( \'JS_lightBox_seckill_box\' );return false;">&times;</a></div><div class="body">' + i + "</div></div></div>";
        $.showMask(199);
        var l = $(j);
        l.css("zIndex", 200);
        l.appendTo($("body"));
        l[0]._showMask = true;
    }
    function a(i, h) {
        $.alert(i, h);
    }
    var f = 0;
    var c = false;
    var b = null;
    var e;
    var d;
    $("#JS_main_group").on("click", ".JS_sec_tmp_1", function() {
        var j = $(this);
        if (!$.cookie("ECS[username]") || $.cookie("meilele_login") != "1") {
            $.showLoginBox(function() {
                hideLayer();
                j.click();
            });
            return false;
        }
        b = j;
        f = j.attr("data-tmp_id");
        if ($.cookie("meilele_login") == 1) {
            var h = $.cookie("ECS[mobile_phone]");
        }
        var i = '<p>欢迎参与秒杀活动，请填写手机号码和验证码进行报名。报名成功后，系统将自动将您的ID与手机号码进行绑定。</p><ul><li>手机号码：<input id="JS_sec_moblie" type="text" type="text" class="input" value="' + (e ? e : (h ? h : "请输入您的手机号")) + '" /></li>';
        if (window._imgCaptcha == 1) {
            i += '<li>&emsp;验证码：<input id="JS_priceDown_catp" style="vertical-align:top;" type="text" class="cap_input" value="" /><a href="javascript:;" onclick="$.getCaptcha($(\'#JS_sec_img_captcha\'));" title="看不清，换一张"><img style="vertical-align:top;" width="80" height="26" src="about:blank" id="JS_sec_img_captcha"></a><span id="JS_sec_check_captcha_su" style="width:20px;height:26px;display:none;background:url(' + $.__IMG + '/images/check_icon8.png) 5px 0px no-repeat;vertical-align:top;"></span></li></ul>';
        } else {
            i += '<li>&emsp;验证码：<input id="JS_priceDown_catp" type="text" class="cap_input" value="' + (d ? d : "") + '" /><input id="JS_get_phone_catp" value="免费获取短信验证码" type="button" class="sms_btn" /></li></ul>';
        }
        i += '<p class="c"><a class="submit" href="javascript:;" title="确定" id="JS_seckill_submit"></a></p>';
        g(i, "报名参与秒杀");
        if (window._imgCaptcha == 1) {
            $.getCaptcha($("#JS_sec_img_captcha"));
            $.checkCaptcha($("#JS_priceDown_catp"), {success: function() {
                    window._imgCaptchaError = false;
                    $("#JS_sec_check_captcha_su").css({"background-position": "5px 0px",display: "inline-block"});
                },error: function() {
                    window._imgCaptchaError = true;
                    $("#JS_sec_check_captcha_su").css({"background-position": "5px -24px",display: "inline-block"});
                }});
        }
        window._ana && window._ana.push(["trackEvent", "miaosha", "click", "unset", f]);
    });
    $(document).on("focus", "#JS_sec_moblie", function() {
        if ($(this).val() == "请输入您的手机号") {
            $(this).val("");
        }
    });
    $(document).on("click", "#JS_get_phone_catp", function() {
        if (c) {
            return false;
        }
        var j = $(this);
        var i = $.trim($("#JS_sec_moblie").val());
        if (!i || i == "请输入您的手机号") {
            a("请输入您的手机号");
            return false;
        }
        if (!/^1[3458][0-9]{9}$/.test(i)) {
            a("请输入正确的手机号码");
            return false;
        }
        c = true;
        function h() {
            var k = 60;
            j.val(k + "秒后重新获取");
            k--;
            var l = setInterval(function() {
                if (k <= 0) {
                    j.val("重新发送短信验证码");
                    clearInterval(l);
                    c = false;
                } else {
                    j.val(k + "秒后重新获取");
                }
                k--;
            }, 1000);
        }
        $.ajax({url: "/interface.html?act=get_mobile_captcha&mobile=" + i,cache: false,dataType: "json",success: function(k) {
                if (k && k.error == 0) {
                    h();
                } else {
                    c = false;
                }
            },error: function() {
                c = false;
            }});
    });
    $(document).on("click", "#JS_seckill_submit", function() {
        var h = $.trim($("#JS_sec_moblie").val());
        var i = $.trim($("#JS_priceDown_catp").val());
        _this = $(this);
        if (!f) {
            return false;
        }
        if (!h || h == "请输入您的手机号") {
            a("请输入您的手机号");
            return false;
        }
        if (!i) {
            a("请输入验证码");
            return false;
        }
        if (window._imgCaptchaError || (window._imgCaptcha && i.length != 4)) {
            a("请输入正确验证码");
            return false;
        }
        $.ajax({url: "/dispose/?act=add_user",type: "post",dataType: "json",data: {mobile: h,check_key: i,id: f},success: function(l) {
                if (l && l.error == 1) {
                    if (l.flag) {
                        $.cookie("meilele_login", "");
                        $.showLoginBox(function() {
                            hideLayer();
                            _this.click();
                        });
                    } else {
                        a(l.msg);
                    }
                } else {
                    if (l && l.error == 0) {
                        a(l.msg);
                        $.closeLightBox("JS_lightBox_seckill_box");
                        var m = b.parent().prev(".JS_count_down_tag");
                        if (m.length) {
                            var n = m.attr("id");
                            var k = n.replace("count_down_OoO_", "") - 0;
                            var j = _tag[k].leftTime;
                            if (j < 2) {
                                b.removeClass("JS_sec_tmp_1").addClass("JS_sec_tmp_3");
                                b = null;
                            } else {
                                b.removeClass("JS_sec_tmp_1").addClass("JS_sec_tmp_2");
                                b = null;
                            }
                        }
                        if (b) {
                            b.removeClass("JS_sec_tmp_1").addClass("JS_sec_tmp_3");
                            b = null;
                        }
                        window._ana && window._ana.push(["trackEvent", "miaosha", "success", h, n]);
                    }
                }
            }});
        return false;
    });
    $(document).on("click", ".JS_sec_tmp_2", function() {
        if (!$.cookie("ECS[username]") || $.cookie("meilele_login") != "1") {
            userLogin();
        }
        return false;
    });
    $(document).on("click", ".JS_sec_tmp_3,.JS_sec_tmp_4", function() {
        var h = $(this);
        if (!$.cookie("ECS[username]") || $.cookie("meilele_login") != "1") {
            $.showLoginBox(function() {
                hideLayer();
                h.click();
            });
            return false;
        }
        f = h.attr("data-tmp_id");
        if (!f) {
            return false;
        }
        $.ajax({url: "/dispose/?act=start_buy",type: "post",dataType: "json",data: "id=" + f,success: function(i) {
                if (i) {
                    if (i.error === 0) {
                        var j = $('<form action="/action-sec_buy-' + f + '.html" target="_self" method="post"><input type="hidden" name="check_key" value="' + i.msg + '"></form>');
                        j.appendTo($("body"));
                        j[0].submit();
                        j.remove();
                    } else {
                        if (i.error == 2) {
                            a(i.msg + '<br/>点击参与<a href="' + i.url + '" class="orange">下期秒杀</a>吧', {onOk: function() {
                                    window.location.href = i.url;
                                }});
                        } else {
                            if (i.error == 1 && i.flag) {
                                if (i.flag == "waiting") {
                                    a(i.msg);
                                    h.removeClass("JS_sec_tmp_3").addClass("JS_sec_tmp_4");
                                } else {
                                    $.cookie("meilele_login", "");
                                    $.showLoginBox(function() {
                                        hideLayer();
                                        h.click();
                                    });
                                }
                            } else {
                                if (i.future == 1) {
                                    a(i.msg + '<br/>点击参与<a href="/miaosha/future.html" class="orange">下期秒杀</a>吧');
                                } else {
                                    a(i.msg);
                                }
                            }
                        }
                    }
                }
            }});
        return false;
    });
    if ($.cookie("ECS[username]") && $.cookie("meilele_login") == "1") {
        hideLayer();
    }
});
/*LDZ:2014-03-20 14:12:03*/