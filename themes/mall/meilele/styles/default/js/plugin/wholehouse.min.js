var MINICOOKIE=($.cookie("QWG")&&$.cookie("QWG").split("|"))||[0,0,1,-1];if(!$.cookie("QWG")){$.cookie("QWG",MINICOOKIE.join("|"),{path:"/"})}function arrayCookie(c,d){if(typeof c!=="number"){return}var a,b=[];if(arguments.length===2){MINICOOKIE[c]=d;a=MINICOOKIE.join("|");$.cookie("QWG",a,{path:"/"});return a}else{a=$.cookie("QWG");b=a.split("|");MINICOOKIE[c]=b[c];return b[c]}}$.wholehouse=function(){return new $.wholehouse.prototype.init()};$.wholehouse.prototype={constructor:$.wholehouse,bg:$.__IMG+"/images/whole_house/qw_plugin.png?3",_bg:$.__IMG+"/images/whole_house/qw_plugin.gif?3",isNeedSave:false,init:function(){this.body=$("body");this.setStyleRule();this.show();$(".JS_qwg_button").css("display","");$.currentWholeHouse=this},setStyleRule:function(){if(!this.styleInserted){var a=[];var b;a.push("#QWG_mini{position:fixed;z-index:141;top:140px;_position:absolute;_top:expression(eval(document.documentElement.scrollTop+140));left:0;width:60px;height:194px;background:url("+this.bg+") no-repeat 0 0;_background-image:url("+this._bg+");cursor:pointer;}");a.push("#QWG_mini .num_icon{position:absolute;display:inline-block;width:22px;height:30px;padding-top: 2px; padding-right:7px;top:-2px;left:40px;background: url("+this.bg+") no-repeat -126px -39px;_background-image:url("+this._bg+");color:#fff;font-size:13px;font-family:Microsoft Yahei;text-align:center;}");a.push("#QWG_mini .num_icon_two{width:31px;background-position:-156px -39px;}");a.push("#QWG_mini .qwg_min_arrow {position: absolute; width: 14px; height: 13px; margin: 163px 0 0 13px; background: url("+this.bg+") no-repeat 0 -201px; _background-image: url("+this._bg+");}");a.push("#QWG_mini .qwg_min_arrow_left { background-position: -15px -201px;}");a.push("#QWG_Box .disabled{color:#999!important;cursor:default;}");a.push("#QWG_Box .f13{font-size:13px;}");a.push("#QWG_Box .f15{font-size:15px;}");a.push("#QWG_Box .f16{font-size:16px;}");a.push("#QWG_Box .f18{font-size:18px;}");a.push('#QWG_Box .yahei{font-family:"Microsoft Yahei";}');a.push("#QWG_Box .f20{font-size:20px;}");a.push("#QWG_Box .f24{font-size:24px;}");a.push("#QWG_Box .f26{font-size: 26px;}");a.push("#QWG_Box{position:fixed;z-index:140;top:0;left:-300px;width:296px;border:2px solid #c9033b;background: #fff;_position:absolute;_top:expression(eval(document.documentElement.scrollTop+0));box-shadow:2px 2px 5px #999;}");a.push("#QWG_Box .qwg_btn {display: inline-block; width: 58px; height: 22px; background: url("+this.bg+") no-repeat 0 -223px; _background-image: url("+this._bg+"); }");a.push("#QWG_Box .qwg_box_top{padding:10px 19px;background:#f3f3f3;}");a.push("#QWG_Box .qwg_box_top .qwg_clear {background-position: 0 -247px; margin-left: 6px; }");a.push("#QWG_Box .qwg_box_top .qwg_box_title{padding-bottom:6px;border-bottom:1px solid #ddd;font-size:13px;font-family:Microsoft Yahei;}");a.push("#QWG_Box .qwg_box_top .qwg_box_title a{cursor:pointer;}");a.push("#QWG_Box .toggle{display:inline-block;vertical-align:top;width:59px;height:16px;overflow:hidden;background:url("+this.bg+") -168px -209px no-repeat;_background-image:url("+this._bg+");}");a.push("#QWG_Box .toggle.close{background-position:-168px -193px;}");a.push("#QWG_Box .qwg_box_tip{margin-top:6px;height:26px;padding:0 9px 8px;line-height:26px;color:#666;background: url("+this.bg+") no-repeat -69px -126px;_background-image:url("+this._bg+");}");a.push("#QWG_Box .qwg_box_progress{position: relative;height:15px;margin-top:6px;padding-top:12px;background:url("+this.bg+") no-repeat -71px -94px;_background-image:url("+this._bg+");overflow: hidden;}");a.push("#QWG_Box .qwg_box_progress .line{; display:block;width:0;height:3px;background:#c9033b;}");a.push("#QWG_Box .qwg_box_level{position:absolute; top: 0; left: 0; padding-left:66px;}");a.push("#QWG_Box .qwg_box_level span{*zoom: 1; display:inline-block;width:26px;height:27px;margin-right:23px;padding-right:2px;background:url("+this.bg+") no-repeat -171px -228px;_background-image:url("+this._bg+");line-height:27px;text-align:center;}");a.push("#QWG_Box.hasFiveLevel .qwg_box_level span{margin-right: 12px;}");a.push("#QWG_Box .qwg_box_level span.last {margin-right: 0;}");a.push("#QWG_Box .qwg_box_level .pass{background-position: -95px -59px;color:#fff;}");a.push("#QWG_Box .qwg_box_level .current{background-position:-69px -59px;}");a.push("#QWG_Box .qwg_box_discount{padding-top:6px;color:#666;line-height:16px;}");a.push("#QWG_Box .qwg_box_discount span{display:inline-block;}");a.push("#QWG_Box .qwg_box_discount .price_type{width:54px;}");a.push("#QWG_Box .qwg_box_discount .dis_type{width:51px;text-align:center;}");a.push("#QWG_Box.hasFiveLevel .qwg_box_discount .dis_type{width:40px;}");a.push("#QWG_Box.hasFiveLevel .qwg_box_discount .dis_type.first{width:44px;}");a.push("#QWG_Box .qwg_save_mask { position: absolute; top: 0; left: 0; width: 270px; margin:-53px 0 0 8px; height: 38px; background: #e1e1e1; opacity: 0.6; filter: alpha(opacity=60);}");a.push("#QWG_Box .qwg_save_btn { position: absolute; top: 0; left: 0; width: 92px; height: 27px; margin: -47px 0 0 97px; background-position: -69px -228px;}");a.push("#QWG_Box:hover .qwg_save_mask {background: #fee9c8;}");a.push("#QWG_Box:hover .qwg_save_btn {background-position: -69px -257px;}");a.push("#QWG_Box .qwg_box_body{margin:7px 1px 15px 8px;overflow-y:scroll;position:relative;}");a.push("#QWG_Box .qwg_box_body .frame{margin-bottom: 38px; border:1px solid #f0f0f0;}");a.push("#QWG_Box .qwg_box_body .qwg_loading {padding-top: 130px; text-align: center; line-height: 32px; }");a.push("#QWG_Box .qwg_box_body .qwg_loading img {background:none; margin-right: 6px; }");a.push("#QWG_Box .qwg_min_goods_box{margin-top:1px;}");a.push("#QWG_Box .qwg_min_goods_box.first{margin-top:0;}");a.push("#QWG_Box .qwg_min_title{display:block;height:28px;line-height:28px;padding:0 12px;background: #f3f3f3;cursor:pointer;text-decoration:none;}");a.push("#QWG_Box .qwg_min_title .cat, #QWG_Box .qwg_min_title .num, #QWG_Box .qwg_min_title .arrow{display:inline-block;height:28px;line-height:28px;}");a.push("#QWG_Box .qwg_min_title .cat{font-size:14px;font-family:Microsoft Yahei;}");a.push("#QWG_Box .qwg_min_title .num{padding-left:10px;color:#999;}");a.push("#QWG_Box .qwg_min_title .arrow{width:9px;height:6px;margin-top:11px;background:url("+this.bg+") no-repeat -198px -40px;_background-image:url("+this._bg+");cursor:pointer;}");a.push("#QWG_Box .qwg_min_title:hover{background:#fef3dc;}");a.push("#QWG_Box .qwg_min_title:hover .cat{color:#333!important;}");a.push("#QWG_Box .qwg_min_goods{padding:7px 0 15px;}");a.push("#QWG_Box .qwg_min_goods_item{border:solid 1px #fff;padding:7px 12px;}");a.push("#QWG_Box .qwg_min_goods_item.hover{background:#fff6e3;border:1px solid #f1dbbc;}");a.push("#QWG_Box .qwg_min_goods_item.hover .qw_goods_del{display:inline-block;}");a.push("#QWG_Box .qwg_min_goods_item.hover a.yahei{color:#c9033b}");a.push("#QWG_Box .qwg_hidden .arrow{background-position:-209px -40px}");a.push("#QWG_Box .qwg_hidden .qwg_min_goods{display:none;}");a.push("#QWG_Box .qwg_min_cat{width:48px;height:60px;color:#555;float:left;}");a.push("#QWG_Box .qwg_min_cat tr td{height:60px;}");a.push("#QWG_Box .qwg_min_cat tr td a {display: inline-block;}");a.push("#QWG_Box .qwg_min_list{width:192px;float:right;background:none;}");a.push("#QWG_Box .qwg_min_list li{position:relative;}");a.push("#QWG_Box .qw_min_img{position:relative;width:90px;height:60px;margin-right:10px;background:url("+this.bg+") no-repeat -238px -32px;_background-image:url("+this._bg+");}");a.push("#QWG_Box .qwg_min_goods_item.hover .qw_min_img {background-position: -238px -193px;}");a.push("#QWG_Box .qw_min_price{width:55px;line-height:16px;padding-top:14px;margin-right:10px;color:#999;}");a.push("#QWG_Box .qw_min_number{width:22px;padding-top:19px;}");a.push("#QWG_Box .qw_min_number input{width:20px;height:20px;line-height:20px;text-align:center; border: 1px solid #ddd;}");a.push("#QWG_Box .qwg_min_footer{height:70px;padding:14px 15px 21px 73px;background:#fff6e3;position:relative}");a.push("#QWG_Box .qwg_min_footer .absTag{width:49px;height:62px;overflow:hidden;position:absolute;left:14px;top:0;}");a.push("#QWG_Box .qwg_min_footer .absTag .discount{height:36px;padding-top:3px;background:#c9033b;color:#fff;text-align:center;font-family:Microsoft Yahei;}");a.push("#QWG_Box .qwg_min_footer .absTag .discount .dis{font-size:14px;line-height:100%;}");a.push("#QWG_Box .qwg_min_footer .absTag .discount .dis strong{font-size:16px;}");a.push("#QWG_Box .qwg_min_footer .absTag .rule_link{display:block;height:20px;line-height:20px;text-align:center;color:#ffbd76;background:#b50033;font-size:11px;font-family:Microsoft Yahei;}");a.push("#QWG_Box .qwg_min_footer .absTag .edge{height:3px;overflow:hidden;background:url("+this.bg+") -72px -43px no-repeat;_background-image:url("+this._bg+");}");a.push("#QWG_Box .qwg_min_footer .price{height:30px;}");a.push("#QWG_Box .qwg_min_footer .price strong, #QWG_Box .qwg_min_footer .price span{display:inline-block;vertical-align:top;}");a.push("#QWG_Box .qwg_min_footer .price strong{color:#c9033b;}");a.push("#QWG_Box .qwg_min_footer .price .yen{font-size:16px;font-family:Microsoft Yahei;padding:7px 2px 0 0;}");a.push("#QWG_Box .qwg_min_footer .price .num{font-size:26px;}");a.push("#QWG_Box .qwg_min_footer .price span{color:#333;padding:8px 0 0 5px;font-size:13px;font-family:Microsoft Yahei;}");a.push("#QWG_Box .qwg_min_footer .button{height:32px;margin-top:8px;}");a.push("#QWG_Box .qwg_min_footer .button a{display:inline-block;vertical-align:top;width:99px;height:32px;background:url("+this.bg+") no-repeat;_background-image:url("+this._bg+");}");a.push("#QWG_Box .qwg_min_footer .button .qwg_to_detail{float:right;background-position:-220px 0;}");a.push("#QWG_Box .qwg_min_footer .button .qwg_to_detail_disable{background-position:-69px -193px;cursor:default;}");a.push("#QWG_Box .qwg_min_footer .button .apply_btn{background-position:-161px -257px;_background-position:-161px -257px;float:left;}");a.push('#QWG_Box .qwg_lightbox{position:absolute;width:244px;top:30px;left:19px;padding:20px 0 20px 16px;background:#fff;border:1px solid #d5d5d5;font-size:13px;font-family:"Microsoft Yahei";box-shadow:2px 2px 4px #DDD;}');a.push("#QWG_Box .qwg_lightbox input{width:100px;height:24px;padding:0 4px;line-height:24px;border:1px solid #ddd;}");a.push("#QWG_Box .qwg_lightbox input.captcha{width:56px;}");a.push("#QWG_Box .get_captcha{display:inline-block;width:71px;height:26px;margin-left:4px;font-family:Arial;line-height:26px;text-align:center;background:url("+this.bg+") no-repeat -253px -164px;_background-image:url("+this._bg+");}");a.push("#QWG_Box .qwg_min_search{width:24px;height:25px;background:url("+this.bg+") no-repeat -183px -164px;_background-image:url("+this._bg+");border:none; margin:0 0 0 6px;vertical-align:top;cursor:pointer}");a.push("#QWG_Box .qwg_min_close{display:inline-block;position:absolute;top:4px;right:4px;width:8px;height:8px;background:url("+this.bg+") no-repeat -219px -40px;_background-image:url("+this._bg+");}");a.push("#QWG_Box .qwg_input_line{margin-bottom:6px;}");a.push("#QWG_Box .qwg_lightbox_btn{height:26px;margin-top:10px;}");a.push("#QWG_Box .qwg_lightbox_btn a{display:inline-block;text-decoration:none;width:67px;height:24px;line-height:22px;text-align:center;font-size:14px;font-weight:bold;border-radius:2px;}");a.push("#QWG_Box .qwg_lightbox_btn .save_btn{border:1px solid #c9033b;background:#c9033b;color:#fff;}");a.push("#QWG_Box .qwg_lightbox_btn .save_btn:hover{color:#fff!important}");a.push("#QWG_Box .qwg_lightbox_btn .save_no_btn{margin-left:6px;border:1px solid #d3d3d3;color:#666;}");a.push("#QWG_Box .qwg_lightbox_btn .save_no_btn:hover{color:#666!important;}");a.push("#QWG_Box .qwg_lightbox .qwg_alert{width:23px;height:23px;margin-right:6px;background:url("+this.bg+") no-repeat -207px -164px;_background-image:url("+this._bg+");}");a.push("#QWG_Box .qwg_lightbox .qwg_alert_ok{background-position:-230px -164px;}");a.push("#QWG_Box .qwg_lightbox .qwg_alert_text{line-height:24px;}");a.push("#QWG_Box .qwg_lightbox .qwg_alert_text span{display:inline-block;vertical-align:top;}");a.push("#QWG_Box .qw_cat_icon{display:none;width:12px;height:12px;margin-right:2px;background:url("+this.bg+") no-repeat -170px -164px;_background-image:url("+this._bg+");vertical-align:middle;}");a.push("#QWG_Box .hover .qw_cat_icon{display:inline-block;}");a.push("#QWG_Box .qw_img_flag{position:absolute;left:0;top:0;display:inline-block;width:28px;height:28px;background:url("+this.bg+") no-repeat -198px -55px;_background-image:url("+this._bg+");}");a.push("#QWG_Box .qw_goods_del{display:none;width:16px;height:14px;background:#fbeed5 url("+this.bg+") no-repeat -123px -71px;_background-image:url("+this._bg+");position:absolute;right:-13px;top:-7px;*top:-8px;border:solid 1px #f1dbbc;}");$.insertStyle(a.join(""));this.styleInserted=true}},show:function(){var a="";this.number=(arrayCookie(1)-0)||0;a+='<div id="QWG_mini" class="qwg_box" onclick="$.currentWholeHouse.toggleList();"><span id="QWG_mini_goods_num" class="num_icon bold'+(this.number>9?" num_icon_two":"")+'">'+this.number+'</span><span class="qwg_min_arrow"></span></div>';this.body.append(a);this.QWG_mini=$("#QWG_mini");this.QWG_min_num=$("#QWG_mini_goods_num")},getListShow:function(a,d){if(!a&&this.data){this.drawDetailList();arrayCookie(0,0)}else{var c=this;var b=a?"?mobile="+a:"";this.drawDetailList((a||d)?true:c.listShow);if(!a&&!this.firstDataGet){this.showBodyLoading()}$.ajax({url:"/mll_api/api/quanwugou_buy_menu"+b,cache:false,dataType:"json",success:function(e){if(a&&(!e.total_num||e.total_num==0)){c.alert("未搜索到对应清单！");return false}if(e.list){c.firstDataGet=true;c.data=e;c.referData();if(a){$("#JS_qwg_phone").html("我的全屋购清单");c.lightBoxClose();c.add(c.getGoodsData(),"clear",true);c.isNeedSave=false;c.alert('<span class="red bold">'+a+"</span><span>的清单已成功导入！</span>",true,true)}}else{c.showBodyError("加载失败")}},error:function(){c.showBodyError("加载失败")}});arrayCookie(0,1)}},addEvent:function(){var a=this;this.QWG_BOX=$("#QWG_Box");this.QWG_GOODS=$("#JS_qwg_box_body");this.QWG_TOGGLE=$("#JS_qwg_mini_toggle");this.QWG_title=$("#JS_qwg_box_title");this.QWG_light=$("#JS_qwg_lightbox");this.QWG_light_body=$("#JS_qwg_lightbox_body");this.QWG_light_msg=$("#JS_qwg_lightbox_msg");this.QWG_GOODS.on("click",".qwg_min_title",function(){var c=$(this).data("name");var b=$(this).parentsUntil("#JS_qwg_box_body .frame").last();if(b.hasClass("qwg_hidden")){b.removeClass("qwg_hidden").siblings().addClass("qwg_hidden")}else{b.addClass("qwg_hidden");c=-1}arrayCookie(3,c);return false}).on("mouseenter",".qwg_min_goods_item",function(){$(this).addClass("hover")}).on("mouseleave",".qwg_min_goods_item",function(){$(this).removeClass("hover")}).on("click",".qw_goods_del",function(){var b=$(this);var e=b.parentsUntil(".qwg_min_list").last();var c=b.data("goods_id");var d=e.find(".goods_num").val();$.ajax({url:"/solr_api/jmll/quanwugou/delsess.do?params="+c,cache:false,dataType:"json",success:function(g){if(g&&g.error==0){if(e.siblings().length>0){if(!e.hasClass("mt15")){e.next().removeClass("mt15")}e.remove()}else{var h=e.find(".qw_min_img").attr("href").replace(/goods-(\d+).html/,"");var f='<a href="'+h+'" class="qw_min_img Left"><span class="qw_img_flag"></span></a><div class="qw_min_price Left c"></div><div class="qw_min_number Left c"></div>';e.html(f)}a.number--;a.referNum();a.data=null;if(a.listShow){a.getListShow()}}}});return false}).on("click",".qwg_retry",function(){a.firstDataGet=false;a.getListShow();return false});this.QWG_light.on("click",".qwg_min_close",function(){a.lightBoxClose();return false}).on("click",".qwg_min_search",function(){var b=$(this).parent().find(".qwg_mobile_input").val();a.mobile=b;if(/^1[\d]{10}$/.test(b)){a.error();a.getListShow(b)}else{a.error("手机号码错误！")}return false}).on("click",".select_save",function(){if(a.isNeedSave){a.saveShow()}return false}).on("click",".select_no_save",function(){a.searchShow();return false}).on("click",".select_no_save_clear",function(){a.clearList();return false}).on("click","#JS_get_captcha",function(){a.getPhoneCaptcha();return false}).on("click",".qwg_list_save_btn",function(){var d=a.QWG_light_body.find(".qw_list_phone").val();var b=a.QWG_light_body.find(".captcha").val();if(!/^1[\d]{10}$/.test(d)){a.error("手机号码错误！");return false}if(b==""){a.error("请输入手机验证码！");return false}a.error("");var c=a.getGoodsData();var f=[];$.each(c,function(h){f.push(h+":"+c[h]+":1")});var e=d+":"+b+":quanwugou|"+f.join("=");var g=a.QWG_light.css("top");$.ajax({url:"/solr_api/jmll/quanwugou/mobile.do?params="+e,cache:false,dataType:"json",success:function(h){if(h&&h.error==0){a.alert(h.msg||"保存成功！",true,true,g);a.isNeedSave=false;$("#JS_qwg_phone").html('<span class="red bold">'+d+"</span>的清单")}else{a.error(h.msg||"发生了错误",false,false,g)}}});return false});this.QWG_title.on("click",".qwg_clear",function(){if(a.isNeedSave){a.isSave("clear")}else{a.clearList()}return false}).on("click",".qwg_search",function(){if(a.isNeedSave){a.isSave()}else{a.searchShow()}return false});$("#JS_qwg_mini_footer").on("click",".qwg_save_btn",function(b){if(a.isNeedSave){var c=b.clientY;a.saveShow(c)}return false});this.QWG_TOGGLE.on("click",function(){a.toggle($(this));return false});this.explodeTag=arrayCookie(2);this.toggle(this.QWG_TOGGLE)},showBodyLoading:function(){var a='<div class="qwg_loading"><img src="'+$.__IMG+'/images/loading.gif" width="32" height="32" />玩命加载中......</div>';this.QWG_GOODS.html(a)},showBodyError:function(b){var a='<div class="qwg_loading">'+(b||"加载失败")+'，请<a href="javascript:void(0);" class="qwg_retry orange">重试</a>！</div>';this.QWG_GOODS.html(a)},error:function(a){if(a){this.QWG_light_msg.html(a).removeClass("none")}else{this.QWG_light_msg.addClass("none")}},isSave:function(b){var a='<p>您当前的清单中包含商品，是否保存？</p><div class="qwg_lightbox_btn c"><a href="javascript:void(0);" class="save_btn select_save">保存</a><a href="javascript:void(0);" class="save_no_btn select_no_save'+(b?"_"+b:"")+'">不保存</a></div>';this.lightBoxShow(a)},saveShow:function(b){var a='<div class="qwg_input_line"><label>手机号：<input type="text" class="qw_list_phone"></label><a href="javascript:void(0);" id="JS_get_captcha" class="get_captcha red">获取验证码</a></div><div class="qwg_input_line"><label>验证码：<input type="text" class="captcha"></label></div><div class="qwg_lightbox_btn"><span>　　　　</span><a href="javascript:void(0);" class="save_btn qwg_list_save_btn">保存清单</a></div>';if(b){b=b-180}this.lightBoxShow(a,b)},searchShow:function(){var a='<label>请输入手机号：<input type="text" class="qwg_mobile_input"></label><button class="qwg_min_search"></button>';this.lightBoxShow(a)},clearList:function(){var b=this;var a='<p class="c">正在删除，请稍后...</p>';this.lightBoxShow(a);$.ajax({url:"/solr_api/jmll/quanwugou/delsess.do?params=999999",cache:false,dataType:"json",success:function(c){if(c.error==0){b.alert(c.msg||"商品已清空！",true,true);b.isNeedSave=false;b.number=0;b.referNum();b.data=null;if(b.listShow){b.getListShow()}}else{b.alert(c.msg||"请求失败！",false,true)}},error:function(){b.alert("请求失败！",false,true)}})},alert:function(c,f,a,e){var b='<div class="qwg_alert_text c"><span class="qwg_alert'+(f?" qwg_alert_ok":"")+'"></span><span>'+c+"</span></div>";this.lightBoxShow(b,e);if(a){var d=this;setTimeout(function(){d.lightBoxClose()},3000)}},lightBoxShow:function(a,b){this.QWG_light_body.html(a);this.QWG_light.removeClass("none").css("top",(b?b+"px":""));this.QWG_light_msg.html("").addClass("none")},lightBoxClose:function(){this.QWG_light.addClass("none")},insertData:function(){var g=this;var b=this.data.list;var d=0;var e;var c='<div class="frame">';var f=arrayCookie(3);var a=-1;$.each(b,function(i,h){if(a==-1&&f&&f==h.space_name){a=d}c+='<div class="qwg_min_goods_box'+(d==0?" first":"")+' qwg_hidden"><a id="_JS_qwg_min_title_'+d+'" class="qwg_min_title clearfix" data-name="'+h.space_name+'"><strong class="cat Left">'+h.space_name+'</strong><span class="num Left">已选<span class="red">&nbsp;'+h.cat_num+'&nbsp;</span>类全屋购商品</span><span class="Right arrow"></span></a><ul class="qwg_min_goods">';$.each(h.cat_list,function(j,k){c+='<li class="qwg_min_goods_item clearfix"><table class="qwg_min_cat bold c"><tbody><tr><td><a href="/category-'+k.cat_pinyin+'/" target="_blank" class="yahei">'+(k.cat_name!="更多"?'<span class="qw_cat_icon"></span>'+k.cat_name+"</a>":'<span class="yahei">'+k.cat_name+"</span>")+'</td></tr></tbody></table><ul class="qwg_min_list">';if(k.list){$.each(k.list,function(l,m){c+='<li class="goods_list clearfix'+(l>0?" mt15":"")+'" data-goods_id="'+m.goods_id+'"><a href="/category-'+m.cat_pinyin+"/goods-"+m.goods_id+'.html" class="qw_min_img Left">'+(m.is_main_class==1?'<span class="qw_img_flag"></span>':"")+'<img src="'+$.__IMG+"/"+m.pic+'" width="90" height="60" alt="'+m.goods_name+'" /></a><div class="qw_min_price Left c">'+m.effect_price_type+'<br><span class="red yen">&yen;'+m.effect_price+'</span></div><div class="qw_min_number Left c"><input type="text" class="goods_num" data-id="'+m.goods_id+'" data-val="'+m.goods_num+'" value="'+m.goods_num+'"></div><a href="javascript:void(0);" class="qw_goods_del Left" data-goods_id="'+m.goods_id+'"></a></li>';if(g.lastAddId&&m.goods_id==g.lastAddId){a=d;g.lastAddId=0}})}else{c+='<li class="clearfix"><a href="/category-'+k.cat_pinyin+'/" class="qw_min_img Left">'+(k.is_main_class==1?'<span class="qw_img_flag"></span>':"")+'</a><div class="qw_min_price Left c"></div><div class="qw_min_number Left c"></div></li>'}c+="</ul></li>"});c+="</ul></div>";d++});c+="</div>";this.QWG_GOODS.html(c);if(a>=0){$("#_JS_qwg_min_title_"+a).trigger("click")}this.QWG_GOODS.find(".goods_num").change(function(){var h=$(this);var i=h.parentsUntil(".qwg_min_list").last().data("goods_id");var j=parseInt(h.val());if(j<1){j=1}else{if(j>9999){j=9999}}j=(j-0)||1;h.val(j);var k=h.data("val");if(j&&j!=k){$.ajax({url:"/solr_api/jmll/quanwugou/updatesess.do?params="+i+":"+j,cache:false,dataType:"json",success:function(l){if(l&&l.error==0){h.val(j);h.data("val",j);g.data=null;if(g.listShow){g.getListShow()}}else{this.error()}},error:function(){h.val(k)}})}})},insertRule:function(){var g=this.data.rule;var f=this.data.pro_grade-0;var c="";var a='<span class="price_type">本站价</span>';var e='<span class="price_type">非本站价</span>';var h=this;var d=0;var b=g.length;this.data.pro_array=[];$.each(g,function(j,k){c+='<span class="'+(d==b-1?" last":"")+(k.pro_grade<=f?" pass":"")+(k.pro_grade==f?" current":"")+'">'+k.pro_grade+"</span>";a+='<span class="dis_type'+(d==0?" first":"")+'"><span class="bold'+(k.pro_grade==f?" red":"")+'">'+k.dis_full+"</span>"+(b==5&&d!=0?"":"折")+"</span>";e+='<span class="dis_type'+(d==0?" first":"")+'"><span class="bold'+(k.pro_grade==f?" red":"")+'">'+k.dis_not_full+"</span>"+(b==5&&d!=0?"":"折")+"</span>";h.data.pro_array.push(k.pro_grade-0);d++});$("#JS_qwg_box_level").html(c);$("#JS_qwg_box_full").html(a);$("#JS_qwg_box_not_full").html(e);this.QWG_BOX[b==5?"addClass":"removeClass"]("hasFiveLevel")},insertPublic:function(){var a=this.data;var d='选择全屋购商品满 <span class="red bold">'+(a.goods_type_num||0)+'</span> 类，共有 <span class="red bold">'+(a.total_num||0)+"</span> 件商品";var b=(a.full_dis===undefined||a.full_dis==0)?10:a.full_dis;var c='<div class="qwg_save_mask"></div><a href="javascript:void(0);" class="qwg_btn qwg_save_btn" title="保存清单"></a><div class="absTag"><div class="discount"><p>全屋购</p><p class="dis"><strong>'+b+'</strong>折</p></div><a href="http://www.web.com/topic/201406-quanwugou.html" target="_blank" class="rule_link">规则说明</a><div class="edge"></div></div><div class="price"><strong class="yen">&yen;</strong><strong class="num">'+(a.total_effect_price||0)+"</strong>"+(a.dis_price>0?'<span class="save">已省&yen;'+(a.dis_price||0)+"</span>":"")+'</div><div class="button"><a href="/quanwugou/qwgapply/" target="_blank" title="免费设计申请" class="apply_btn"></a><a href="javascript:;" class="qwg_to_detail'+(a.total_num>0?"":" qwg_to_detail_disable")+'" onclick="$.currentWholeHouse.linkToListPage(this);"></a></div>';$("#JS_qwg_box_tip").html(d);$("#JS_qwg_mini_footer").html(c)[a.pro_grade>0?"addClass":"removeClass"]("qwg_activating");this.number=(a.total_num-0)||0;if(a.total_num>0){this.isNeedSave=true}},referData:function(){this.insertPublic();this.insertRule();this.insertData();this.prosses();this.referNum()},toggleList:function(){var a=this;if(!this.listShow){this.getListShow();var b=window.pageY||document.documentElement.scrollTop||document.body.scrollTop||0;this.QWG_BOX.animate({left:"0px"},{step:function(c){a.QWG_mini.css({left:(300+c)+"px"})},done:function(){a.QWG_mini.find(".qwg_min_arrow").addClass("qwg_min_arrow_left")}});this.listShow=true}else{this.QWG_BOX.stop(true).animate({left:"-300px"},{step:function(c){a.QWG_mini.css({left:(300+c)+"px"})},done:function(){a.QWG_mini.find(".qwg_min_arrow").removeClass("qwg_min_arrow_left")}});this.listShow=false}},drawDetailList:function(c){if(!this.QWG_BOX){var a=this.data;var b="";b+='<div id="QWG_Box" class="qwg_box"><div class="qwg_box_top"><div id="JS_qwg_box_title" class="qwg_box_title clearfix"><span class="Left"><span id="JS_qwg_phone">我的全屋购清单</span></span></span><a class="Right qwg_btn qwg_clear" title="清空"></a><a class="Right qwg_btn qwg_search" title="搜索"></a></div><div id="JS_qwg_box_tip" class="qwg_box_tip"></div><div class="qwg_box_progress"><span id="JS_progress_bar" class="line"></span><div id="JS_qwg_box_level" class="qwg_box_level"></div></div><div id="JS_qwg_box_full" class="qwg_box_discount"></div><div id="JS_qwg_box_not_full" class="qwg_box_discount"></div></div><div style="text-align:center;"><a href="javascript:;" id="JS_qwg_mini_toggle" class="toggle"></a></div><div id="JS_qwg_box_body" class="qwg_box_body"></div><div id="JS_qwg_mini_footer" class="qwg_min_footer qwg_activating"></div><div id="JS_qwg_lightbox" class="qwg_lightbox none"><a href="javascript:void(0);" class="qwg_min_close"></a><div id="JS_qwg_lightbox_body" class="qwg_lightbox_body"></div><p id="JS_qwg_lightbox_msg" class="qwg_lightbox_body red"></p></div></div>';this.body.append(b);this.addEvent()}this.autoHeight();if(!c){}},change:function(a,b){},getGoodsData:function(){var a=this.QWG_GOODS.find(".goods_list");var b={};a.each(function(d){var c=a.eq(d);var e=c.data("goods_id");var f=c.find(".goods_num").val();b[e]=f});return b},referNum:function(){var a=this.number;this.QWG_min_num.html(a+"")[a>9?"addClass":"removeClass"]("num_icon_two");arrayCookie(1,a);if(!this.QWG_title){return}if(this.isNeedSave){this.QWG_title.find(".qwg_save").removeClass("disabled")}else{this.QWG_title.find(".qwg_save").addClass("disabled")}},add:function(a,i,c,e,b){var f="";if(typeof a=="string"){f=a}else{var h=[];var d=0;$.each(a,function(j){if($.isNumeric(a[j])){h.push(j+":"+a[j]+":1");d+=1}else{h.push(a[j].goods_id+":"+a[j].goods_number+":"+a[j].cat_id);d+=1}});f=h.join("=")}if(f){var g=this;$.ajax({url:"/solr_api/jmll/quanwugou/sess.do?"+(i?"type="+i+"&":"")+"params="+f,cache:false,dataType:"json",success:function(k){if(k&&k.error==0&&!c){window._ana&&window._ana.push(["trackEvent","addToHouseBuy",f,"success"]);window._gaq&&window._gaq.push(["_trackEvent","addToHouseBuy",f,"success"]);g.data=null;g.isNeedSave=true;if(h&&h.length==1){g.lastAddId=f.match(/\d+/)[0]}if(e&&e.x&&e.y){b=b||($.__IMG+"/themes/paipai/images/blank.gif");var j=$('<div><img src="'+b+'" width="45" height="31"></div>');var l=window.pageY||document.documentElement.scrollTop||document.body.scrollTop||0;j.css({border:"2px solid #c9033b",position:"absolute",top:(l+e.y-20)+"px",left:(e.x-26)+"px",width:"45px",height:"31px",padding:"2px","z-index":"2000",background:"#fff"}).appendTo($("body")).animate({left:g.listShow?"380px":"80px",top:(l+144)+"px"},{easing:"linear",duration:600,done:function(){j.animate({left:"-=80px",opacity:0},{easing:"linear",duration:700,done:function(){j.remove();if(k.count||k.count=="0"){g.number=parseInt(k.count)}else{g.number+=d}g.referNum()}})}})}if(g.listShow){g.getListShow()}}}})}},getPhoneCaptcha:function(){if(this.gotPhoneCaptcha){return false}else{var b=this;var a=b.QWG_light_body.find(".qw_list_phone").val();if(!/^1[\d]{10}$/.test(a)){this.error("手机号码错误！");return false}else{this.error("")}this.gotPhoneCaptcha=true;$.ajax({url:"/solr_api/captcha/mobileCaptcha/create_send_captcha.do?121&phoneNumber="+a+"&durationTime=2500&captchaType=quanwugou&from_type=quanwugou",cache:false,dataType:"json",success:function(c){b.QWG_light_body.find("#JS_get_captcha").text("已发至手机");setTimeout(function(){b.gotPhoneCaptcha=false;b.QWG_light_body.find("#JS_get_captcha").text("获取验证码")},120000)}})}},prosses:function(){var o=0,e=35,s=15,b=this.data.goods_type_num-0,q=this.data.pro_array,f=q.length,p=$("#JS_progress_bar"),j=q[0],h=q[f-1],r=null;var a=22;if(f==5){e=49;s=9}if(b<j){o=e}else{if(b>=h){o=e+s*(f*2+1)+f*a}else{if(b>=j&&b<h){for(var c=0;c<f;c++){var d=c+1;if(b===q[c]){o=e+s*(d*2-1)+d*a;break}else{var n=q.slice(0);n.push(b);n.sort(function(i,k){return i-k});for(var g=0,l=n.length;g<l;g++){if(n[g]===b){r=g;o=e+s*(g*2+1)+g*a;break}}}}}}}p.animate({width:o+"px"},500)},linkToListPage:function(a){if($(a).hasClass("qwg_to_detail_disable")){return}var d=this.mobile===undefined?"":this.mobile;var b=$('<form id="JS_go_whole_buy_form" action="/quanwugou/pricelist.html?origin=cart" method="post" target="_blank"></form>');var c=$('<input type="hidden" name="mobile" value="'+d+'" />');b.append(c);$("body").append(b);$("#JS_go_whole_buy_form").submit()},autoHeight:function(){this.boxHeight=this.QWG_BOX.height();this.screenHeight=$(window).height();this.displayHeight=this.screenHeight-4;this.headerHeight=184;this.toggleHeight=84;this.footerHeight=105;this.bodyHeight=this.displayHeight-this.headerHeight-this.footerHeight-20;this.bodyHeight=this.explodeTag===1?this.bodyHeight+this.toggleHeight:this.bodyHeight;this.QWG_BOX.css({height:this.displayHeight+"px"});this.QWG_GOODS.css({height:this.bodyHeight+"px"})},toggle:function(a){this.autoHeight();var d=$("#JS_qwg_box_tip"),b=$("#JS_qwg_box_full"),c=$("#JS_qwg_box_not_full");if(this.explodeTag!=1){a.addClass("close");d.hide();b.hide();c.hide();this.bodyHeight=this.bodyHeight+this.toggleHeight;this.QWG_GOODS.css({height:this.bodyHeight+"px"});this.explodeTag=1;arrayCookie(2,0)}else{a.removeClass("close");d.show();b.show();c.show();this.bodyHeight=this.bodyHeight-this.toggleHeight;this.QWG_GOODS.css({height:this.bodyHeight+"px"});this.explodeTag=0;arrayCookie(2,1)}}};$.wholehouse.prototype.init.prototype=$.wholehouse.prototype;$(window).resize(function(){});
/*CJ:2014-06-10 16:55:16*/