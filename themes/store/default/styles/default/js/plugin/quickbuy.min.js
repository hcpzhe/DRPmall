var undefined;$.quickBuy=function(b,a,c){return new $.quickBuy.prototype.init(b,a,c);};$.quickBuy.prototype={constructor:$.quickBuy,bg:"http://web/images/zhuanti/upload/a_1374111909.gif",init:function(b,a,c){if(!b){$.alert("无效商品ID");return;}if(this.isAjax){return;}this.setting=$.extend({countSec:120},c);this.setting.goodsId=b;if(this.setting.type==="sendClocked"){this.setting.needCaptcha=false;if($.quickBuy.current){$.quickBuy.current.remove();}if(!$.quickBuy.styleInserted){this.insertStyle();}this.box=this.makeBox();$.quickBuy.current=this;return;}this.setting.goodsNumber=parseInt(a)||1;this.isAjax=true;var d=this;$.ajax({url:"/mll_api/api/quick_buy?goods_id="+b+"&goods_number="+a,dataType:"json",cache:false,success:function(e){if(e.Is_Creat_Order-0==0){d.setting.needCaptcha=(e.Var_Value==1)?false:true;d.setting.phoneNumber=e.Phone_1;d.setting.isLogin=!!e.user_id;if(e.count_sec>0){d.setting.countSec=e.count_sec;}if($.quickBuy.current){$.quickBuy.current.remove();}if(!$.quickBuy.styleInserted){d.insertStyle();}d.box=d.makeBox();$.quickBuy.current=d;}else{$.alert(e.Reason||"发生网络错误，请稍候再试。");}},error:function(){$.alert("发生网络错误，请稍候再试。");},complete:function(){d.isAjax=false;}});},insertStyle:function(){if($.quickBuy.styleInserted==true){return;}var a=[];var b;a.push(".qb_box {width:440px;padding-bottom:20px;border:5px solid #aaa;border-color:rgba(170,170,170,.8);background:#fff;margin:0px auto;overflow:hidden;}");a.push(".qb_content {padding-top:19px;}");a.push(".qb_input {width:195px;height:28px;border:1px solid #c1c1c1;padding:0;margin:0;color:#555;padding-left:5px;line-height:28px;}");a.push(".qb_captcha{width:64px;height:28px;border:1px solid #c7c7c7;padding:0;margin:0;vertical-align:top;color:#555;padding-left:5px;line-height:28px;}");a.push(".qb_content label {height:26px; line-height: 26px;width:150px;text-align:right;display:inline-block;vertical-align:top;}");a.push(".qb_submit {height:31px;;width:81px;color:#fff;text-align:center;border:1px solid #c9043c;margin:0;padding:0;font-weight:bold;background:#d0033c;border-radius:2px;font-family:微软雅黑;font-size:14px;}");a.push(".qb_submit:hover {background:#ff0030}");a.push(".prz_input {width:200px;height:28px;border:1px solid #c7c7c7;padding:0;margin:0;vertical-align:top;color:#555;padding-left:5px;line-height:28px;}");a.push(".prz_captcha {width:60px;}");a.push(".prz_yuanjiao {background:#FAFAFA;font-weight:bold;text-align:center;width:40px;font-family:Arial;border:2px solid #ccc;border-radius:5px;padding:6px 6px;display:inline-block;margin-left:10px;}");a.push(".prz_cellcaptcha {width:60px;}");a.push(".prz_yuanjiao2 {width:55px;color:#888888;}");a.push(".prz_sure_inline{display:inline-block;}");a.push(".prz_sure {margin-left:10px;width:100px;height:20px;padding-top:8px;color:#0099CC;display:none;}");a.push(".prz_yuanjiao3 {width:100px;color:#999999;display:none;}");a.push(".prz_yuanjiao5 {width:110px;color:#999999;display:none;}");a.push(".qb_login {padding: 4px 16px; background: #f7f7f7; border: 1px solid #ddd; border-radius: 2px;}");a.push(".qb_login:hover {background: #f0f0f0;}");$.insertStyle(a.join(""));$.quickBuy.styleInserted=true;},makeBox:function(){window._ana&&window._ana.push(["trackEvent","buyBonus"+(this.setting.type?("_"+this.setting.type):""),"click","unset",this.setting.goodsId]);window._gaq&&window._gaq.push(["_trackEvent","buyBonus_click"+(this.setting.type?("_"+this.setting.type):""),"unset",this.setting.goodsId.toString()]);var a="请输入您的手机号";var c="";c+='<div class="qb_box">';c+='<div class="clearfix" style="height:40px;line-height:40px;border-bottom:1px solid #dedede;padding-left:10px;color:#333;"><div class="Left" style="font-size:16px;font-family:微软雅黑;">您的信息</div><div class="Right" style="padding-right:10px;"><a style="font-size:18px;color:#909090;font-weight:bold;" href="javascript:;" onclick="$.closeLightBox(\'{=id}\');">&times;</a></div></div>';c+='<div class="qb_content">';c+='<div><label for="_JS_quickBuy_input_">手机号：</label><input class="qb_input" value="'+(this.setting.phoneNumber||a)+'" onfocus="if(this.value==\''+a+'\')this.value=\'\'" onkeypress="$.quickBuy.current.keyPress(event);" id="_JS_quickBuy_input_" name="_JS_quickBuy_input_" /></div>';c+='<div style="margin-top:10px;" id="_JS_quickBuy_captcha_box" class="'+(this.setting.needCaptcha?"":"none")+'"><label>手机校验码：</label>';c+='<input id="_JS_quickBuy_prz_cellcaptcha_" class="prz_input prz_cellcaptcha" value="" onfocus="if(this.value==\'手机验证码\')this.value=\'\'" ><span id="_JS_quickBuy_prz_btn2_" onclick="$.quickBuy.current.getCellCaptcha();" class="pointer prz_yuanjiao prz_yuanjiao2">免费获取</span>';c+='<span id="_JS_quickBuy_prz_btn5_" class="prz_yuanjiao prz_yuanjiao5"><span id="_JS_quickBuy_sec_count">'+this.setting.countSec+"</span>秒后重新获取</span>";c+="</div>";c+='<div style="margin-top:10px;"><label></label><input id="_JS_quickBuy_btn_" type="button" style="" class="pointer qb_submit" onclick="$.quickBuy.current.send();" value="提 交" /></div>';c+='<div style="color:#454545;padding-top:10px;text-align:center" id="_JS_quickBuy_msg_box_"></div>';c+="</div>";c+="</div>";c+="";var b=$.lightBox(c,{},true);this.msgBox=$("#_JS_quickBuy_msg_box_");this.phoneNumberInput=$("#_JS_quickBuy_input_");this.countBox=$("#_JS_quickBuy_sec_count");this.captchaInput=$("#_JS_quickBuy_prz_cellcaptcha_");return b;},remove:function(){if(this.box){if(this.box.remove){this.box.remove();}else{$(this.box).remove();}}$.quickBuy.current=null;},keyPress:function(a){a=a||window.event;if(a.keyCode==13){this.send();}},getPhoneNumber:function(){var a=$.trim(this.phoneNumberInput.val());if(!/^1\d{10,10}$/.test(a)){this.msg("请输入正确手机号");return false;}return a;},getCaptcha:function(){var a=this.captchaInput.val();if(!a){this.msg("请输入正确手机验证码");return false;}return a;},send:function(){if(this.lock){return;}this.msg("");var b;var a="";var c=this;if((b=this.getPhoneNumber())&&(!this.setting.needCaptcha||(a=this.getCaptcha()))){this.lock=true;if(this.setting.type=="sendClocked"){$.ajax({url:"/solr_api/Order/reminder/experience_vouchers_reminder.do",data:"mobile="+b+"&goodsId="+this.setting.goodsId,cache:false,dataType:"json",success:function(d){if(d.error==0){window._ana&&window._ana.push(["trackEvent","buyBonus"+(c.setting.type?("_"+c.setting.type):""),"success",b,c.setting.goodsId]);window._gaq&&window._gaq.push(["trackEvent","buyBonus_success"+(c.setting.type?("_"+c.setting.type):""),"success",b.toString(),c.setting.goodsId.toString()]);$.alert(d.msg||"设置成功",{type:"ok"});c.remove();}else{if(d.error==2){c.remove();}else{c.lock=false;}$.alert(d.msg||"设置失败");}},error:function(){c.lock=false;$.alert("网络发生故障，请稍后再试！");}});}else{$.ajax({url:"/couponOrder/",data:"f=pc&goods_id="+this.setting.goodsId+"&quantity="+this.setting.goodsNumber+"&mobile="+b+"&captcha="+a,dataType:"json",cache:false,success:function(d){if(!(d.error-0)&&d.orderId){window._ana&&window._ana.push(["trackEvent","buyBonus"+(c.setting.type?("_"+c.setting.type):""),"success",b,c.setting.goodsId]);window._gaq&&window._gaq.push(["trackEvent","buyBonus_success"+(c.setting.type?("_"+c.setting.type):""),"success",b.toString(),c.setting.goodsId.toString()]);location.href="/pay.html?s="+d.orderId;}else{$.alert(d.msg||"发生网络错误，请稍候再试。");}c.lock=false;},error:function(){$.alert("发生网络错误，请稍候再试。");c.lock=false;}});}}},msg:function(b,c){var a=c?"-42":"-27";if(b){b='<span style="display:inline-block;vertical-align:middle;width:14px;height:14px;background:url('+this.bg+") "+a+'px -65px;margin-right:6px;"></span><span style="vertical-align:middle;color:#f24443;">'+b+"</span>";}this.msgBox.html(b);},getCellCaptcha:function(){if(this.cellLock){return;}var a=this.getPhoneNumber();var b=this;this.msg("");if(a){this.cellLock=true;$.ajax({url:"/mll_api/api/quick_buy?getCellCaptcha=1&goods_id="+this.setting.goodsId+"&goods_number="+this.setting.goodsNumber+"&phone="+a,type:"GET",cache:false,dataType:"json",success:function(c){if(c.error==0){$("#_JS_quickBuy_prz_btn5_").css("display","inline-block");$("#_JS_quickBuy_prz_btn2_").hide();b.startCount();}else{var d=c.msg||"手机校验码发送失败！请稍候再试。";b.msg(d);}b.cellLock=false;},error:function(){b.msg("手机校验码发送失败！请稍候再试。");b.cellLock=false;}});}},startCount:function(){this.secLeft=this.setting.countSec;this.countHandler=setInterval(function(){$.quickBuy.current.secCount();},1000);},secCount:function(){this.secLeft--;if(this.secLeft>0){this.countBox.html(this.secLeft);}else{clearInterval(this.countHandler);$("#_JS_quickBuy_prz_btn5_").hide();$("#_JS_quickBuy_prz_btn2_").css("display","inline-block");this.countBox.html(this.setting.countSec);}}};$.quickBuy.prototype.init.prototype=$.quickBuy.prototype;
/*LDZ:2014-06-12 09:49:14*/